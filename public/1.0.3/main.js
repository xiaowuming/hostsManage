!function(t){function e(n){if(a[n])return a[n].exports;var i=a[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){t.exports=a(1)},function(t,e){"use strict";$(function(){var t={_noAuthText:"<p>\u65e0\u6743\u9650\u64cd\u4f5c,\u8bf7\u7528\u5982\u4e0b\u547d\u4ee4\u542f\u52a8\u670d\u52a1:<p><code>sudo hosts-manage start</code>",init:function(){this.bindTab(),this.bindBtn()},bindBtn:function(){var t=this;$("#J_delete_all_btn").on("click",function(){t.dialog.confirm("\u786e\u5b9a\u6279\u91cf\u5220\u9664?",function(){t.deleteHosts()})}),$("#J_pause_all_btn").on("click",function(){t.pauseHosts()}),$("#J_start_all_btn").on("click",function(){t.startHosts()}),$("#J_add_group_btn").on("click",function(){t.addGroup()}),$("#J_tab_content").on("click",".J_delete_item",function(){$("input[type=checkbox]").prop("checked",!1),$(this).parents("li").find("input[name=item]").attr("data-select",!0),t.deleteHosts()}).on("click",".invalidAction",function(){var e=$(this);$("input[type=checkbox]").prop("checked",!1),e.parents("li").find("input[name=item]").attr("data-select",!0),e.parents(".item").hasClass("invalid")?t.startHosts():t.pauseHosts()}).on("click",".J_delete_group",function(){t.dialog.confirm("\u786e\u5b9a\u5220\u9664\u8be5\u7ec4?",function(){t.deleteGroup()})}).on("click",".J_edit_group",function(){var e=$(this).parents(".J_pane").attr("data-label");t.editGroup($(this).parents(".J_pane"),e)}).on("click",".J_add_hosts",function(){var e=$(this);t.editHostsForm("\u6dfb\u52a0Hosts","","",function(a,n){var i='<li class="J_item item">                        <div class="select"><input name="item" type="checkbox" data-ip="'+a+'" data-domain="'+n+'" data-isinvalid="false">                        </div>                        <div class="invalidAction">#</div>                        <div class="ip">'+a+'</div>                        <div class="domain">'+n+'</div>                            <div class="delete J_delete_item">x</div>                            </li>';e.parents(".head").after(i),t.startHosts()})}).on("click",".ip,.domain",function(){var e=$(this).parents(".J_item").find("input[name=item]"),a=e.attr("data-ip"),n=e.attr("data-domain");t.editHostsForm("\u4fee\u6539Hosts",a,n,function(a,n){e.attr("data-ip",a).attr("data-domain",n),e.parents(".J_item").find(".ip").text(a),e.parents(".J_item").find(".domain").text(n),t.startHosts()})}).on("change",".J_all_select",function(){$(this).parents(".J_pane").find("input[name=item]").prop("checked",$(this).prop("checked"))}).on("change","input[name=item]",function(){var t=$(this);if(t.prop("checked")){var e=t.parents(".J_pane").find("input[name=item]").size(),a=t.parents(".J_pane").find("input[name=item]:checked").size();e==a&&t.parents(".J_pane").find(".J_all_select").prop("checked",!0)}else t.parents(".J_pane").find(".J_all_select").prop("checked",!1)}),$("#J_start_dns").on("click",function(){t.startDnsServer($(this))})},startDnsServer:function(t){var e=this;$.ajax({url:"/start_dns",data:{},success:function(a){100!=a.code?e.dialog.alert(e._noAuthText):(t.remove(),e.dialog.alert("<h3>\u542f\u52a8\u6210\u529f</h3><p>\u624b\u673a\u4e0a\u8bbe\u7f6eDNS\u4e3a["+_localIP+"]\u53ef\u4ee5\u540c\u6b65\u672c\u673aHosts.</p>"))}})},editHostsForm:function(t,e,a,n){var i=this,o=$('<form>                <div class="form-group">                <label for="J_newGroupName">IP:</label>            <input type="text" required class="form-control" name="ip" value="'+e+'" id="J_new_ip" placeholder="IP">                </div>                 <div class="form-group">                <label for="J_newGroupName">Domamin:</label>            <input type="text" required class="form-control" name="domain" value="'+a+'" id="J_new_domain" placeholder="Domain">                </div>            <button type="submit" class="btn btn-info">\u786e\u5b9a</button>            <button type="button" class="btn btn-default" data-dismiss="modal">\u53d6\u6d88</button>                </form>');this.dialog.init(t,o),o.on("submit",function(){return n&&n($("#J_new_ip").val().trim(),$("#J_new_domain").val().trim()),i.dialog.closeDialog(),!1})},deleteGroup:function(){$("#J_nav_tabs").find("li.active").remove(),$("#J_tab_content").find(".J_pane.active").remove(),$("#J_nav_tabs").find("li").eq(1).addClass("active"),$("#J_tab_content").find(".J_pane").eq(0).addClass("active"),this.startHosts()},addGroup:function(){if($(".J_pane").size()>8)return this.dialog.alert("\u4e0d\u80fd\u591a\u4e8e8\u4e2a\u7ec4\u54e6."),!1;var t=this;t.groupEditForm("\u6dfb\u52a0\u7ec4","",function(e){$(".hosts .active").removeClass("active");var a=(new Date).getTime(),n='<li role="presentation" class="active"><a href="#_'+a+'" aria-controls="home" role="tab" data-toggle="tab">'+e+"</a></li>";$("#J_nav_tabs").append(n);var i='<div role="tabpanel" data-label="'+e+'" class="J_pane tab-pane active" id="_'+a+'">                    <ul class="hosts_items"><li class="item head">                    <div class="allSelect">                    <label><input type="checkbox" class="J_all_select"> \u5168\u9009</label>                    </div>                    <div class="action">                    <button class="btn btn-default btn-xs J_add_hosts" type="submit">\u6dfb\u52a0Hosts</button>                    <button class="btn btn-default btn-xs J_edit_group" type="submit">\u4fee\u6539\u7ec4\u540d</button>                    <button class="btn btn-default btn-xs J_delete_group" type="submit">\u5220\u9664\u7ec4</button>                    </div>                    </li></ul></div>';$("#J_tab_content").append(i),t.startHosts()})},editGroup:function(t,e){var a=this;a.groupEditForm("\u4fee\u6539\u7ec4",e,function(e){t.attr("data-label",e),$("#J_nav_tabs .active a").text(e),a.startHosts()})},groupEditForm:function(t,e,a){var n=this,i=$('<form>                <div class="form-group">                <label for="J_newGroupName">\u7ec4\u540d</label>            <input type="text" required class="form-control" name="groupName" value="'+e+'" id="J_newGroupName" placeholder="\u7ec4\u540d">                </div>            <button type="submit" class="btn btn-info">\u786e\u5b9a</button>            <button type="button" class="btn btn-default" data-dismiss="modal">\u53d6\u6d88</button>                </form>');this.dialog.init(t,i),i.on("submit",function(){return a&&a($("#J_newGroupName").val().trim()),n.dialog.closeDialog(),!1})},bindTab:function(){$('a[data-toggle="tab"]').on("shown.bs.tab",function(t){$("input[type=checkbox]").prop("checked",!1)})},getAllHosts:function(){var t={};return $(".J_pane").each(function(){var e=[];t[$(this).attr("data-label")]=e,$(this).find("input[name=item]").each(function(){var t=$(this),a={};a.selected=t.prop("checked"),"true"==t.attr("data-select")&&(a.selected=!0),a.ip=t.attr("data-ip"),a.domain=t.attr("data-domain"),a.isInvalid="true"==t.attr("data-isinvalid")?!0:!1,e.push(a)})}),t},startHosts:function(){var t=this,e=t.getAllHosts();for(var a in e){var n=e[a];for(var i in n){var o=n[i];o.selected&&(o.isInvalid=!1),delete o.selected}}this.postHosts(e,function(){$("input[name=item]:checked,input[data-select=true]").parents(".item").removeClass("invalid"),$("input[type=checkbox],input[data-select=true]").prop("checked",!1).removeAttr("data-select")})},pauseHosts:function(){var t=this,e=t.getAllHosts();for(var a in e){var n=e[a];for(var i in n){var o=n[i];o.selected&&(o.isInvalid=!0),delete o.selected}}this.postHosts(e,function(){$("input[name=item]:checked,input[data-select=true]").parents(".item").addClass("invalid"),$("input[type=checkbox],input[data-select=true]").prop("checked",!1).removeAttr("data-select")})},deleteHosts:function(){var t=this,e=t.getAllHosts(),a={};for(var n in e){a[n]=[];var i=e[n],o=[];for(var s in i){var l=i[s];l.selected||o.push(l),delete l.selected}a[n]=o}this.postHosts(a,function(){$("input[name=item]:checked,input[data-select=true]").parents(".item").remove(),$("input[type=checkbox],input[data-select=true]").prop("checked",!1).removeAttr("data-select")})},postHosts:function(t,e){var a=this;$.ajax({url:"/update",type:"post",data:{content:JSON.stringify(t)},success:function(t){t.result===!1?setTimeout(function(){a.dialog.alert(a._noAuthText)},500):e&&e()}})},dialog:{init:function(t,e,a,n){a&&("sm"==a?($("#J_dialog_modal").removeClass("bs-example-modal-lg").addClass("bs-example-modal-sm"),$("#J_dialog_type").removeClass("modal-lg").addClass("modal-sm")):null==a?($("#J_dialog_modal").removeClass("bs-example-modal-lg"),$("#J_dialog_type").removeClass("bs-example-modal-lg")):($("#J_dialog_modal").addClass("bs-example-modal-lg").removeClass("bs-example-modal-sm"),$("#J_dialog_type").addClass("modal-lg").removeClass("modal-sm"))),1==n?$("#J_dialog_modal").modal("show"):$("#J_dialog_modal").modal({backdrop:"static",keyboard:!1}),$("#J_dialog_title").html(t),"string"==typeof e?$("#J_dialog_content").html(e):$("#J_dialog_content").empty().append(e)},alert:function(t,e,a){var n=this,i='<div></div><div class="fn14"> '+t+'</div><div class="ac mt10 bt1 pt10"><button type="button" id="J_confirm_btn" class="btn btn-success">\u786e\u5b9a</button></div></div>';$("#J_dialog_modal").modal("show"),n.init("\u63d0\u793a",i,a||"sm"),$("#J_confirm_btn").on("click",function(){n.closeDialog(),e&&e()})},confirm:function(t,e){var a=this,n='<div></div><div class="fn14"><i class="glyphicon glyphicon-question-sign orange"></i> '+t+'</div><div class="ar mt10 bt1 pt10"><button type="button" id="J_confirm_btn" class="btn btn-success">\u786e\u5b9a</button><button type="button" id="J_cancel_btn" class="btn btn-default ml10">\u53d6\u6d88</button></div></div>';$("#J_dialog_modal").modal("show"),a.init("\u8bf7\u786e\u8ba4",n,"sm"),$("#J_cancel_btn").on("click",a.closeDialog),$("#J_confirm_btn").on("click",function(){a.closeDialog(),setTimeout(function(){e()},500)})},closeDialog:function(t){$("#J_dialog_modal").modal("hide"),"function"==typeof t&&setTimeout(function(){t()},600)}}};t.init()})}]);